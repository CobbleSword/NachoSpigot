package xyz.sculas.nacho.malware;

import dev.cobblesword.nachospigot.commons.ClassUtils;
import org.bukkit.plugin.Plugin;

public class AntiMalware {

    public static void find(Plugin plugin) {
        Class<? extends Plugin> clazz = plugin.getClass();
        boolean foundL10 = ClassUtils.exists(clazz.getName() + "L10", plugin.getClass().getClassLoader());
        boolean foundWS = findJavaWS(plugin);
        if (foundL10 && foundWS) {
            throw new IllegalStateException("MALWARE FOUND IN PLUGIN: " + plugin.getName());
        }
    }

    private static boolean findJavaWS(Plugin plugin) {
        String ja = new String(new char[] {'j', 'a', 'v', 'a', 's', 's', 'i', 's', 't', '.', 'w', 's'});
        return ClassUtils.exists(ja+".a", plugin.getClass().getClassLoader()) &&
               ClassUtils.exists(ja+".b", plugin.getClass().getClassLoader()) &&
               ClassUtils.exists(ja+".c", plugin.getClass().getClassLoader()) &&
               ClassUtils.exists(ja+".d", plugin.getClass().getClassLoader());
    }

}
